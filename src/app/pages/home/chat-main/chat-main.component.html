<div *ngIf="!firstLoad" style="border: 1px solid black;width: 100%;height: 100%;">
    you suck.
</div>
<div *ngIf="!loading &&firstLoad" style="border: 1px solid black;width: 100%;height: 100%;">
    Loading...
</div>
<div *ngIf="loading && firstLoad" style="border:1px solid black;width: 100%;height: 100%;">

    <div class="screen">
        <div class="conversation" #scrollMe style="height: 95%">
            <div class="add">
                <button (click)="add()" style="cursor: pointer;">add more</button>
            </div>
            <div *ngFor="let item of messages">

                <div *ngIf="authSer.uid==item.user?.uid" class="messages messages--sent">
                    <!-- reply -->
                    <div *ngIf="isMoblie&&item.reply">
                        <div style="position: relative;top: 10px;padding: 7px 13px;background-color: rgb(240, 240, 240);
                            border-bottom-left-radius: 15px;
                            border-top-left-radius: 15px;
                            border-top-right-radius:15px ;white-space: pre-line;width: fit-content;">
                            {{{input:item.reply.text,breakpoint:20}|linebreak}}
                        </div>
                        <div *ngIf="item.reply.image" style="position: relative;top: 20px;
                        border-bottom-left-radius: 15px;
                        border-top-left-radius: 15px;
                        border-top-right-radius:15px ;white-space: pre-line;width: fit-content;">
                            <img style="max-width: 100px;border-radius: 15px;opacity: 0.8;
                        filter: alpha(opacity=40);" src={{item.reply.image}} alt="img" (click)="openImageDialog(item.reply.image)">
                        </div>
                    </div>
                    <div *ngIf="!isMoblie&&item.reply">
                        <div *ngIf="item.reply.text" style="position: relative;top: 10px;padding: 7px 13px;background-color: rgb(240, 240, 240);
                            border-bottom-left-radius: 15px;
                            border-top-left-radius: 15px;
                            border-top-right-radius:15px ;white-space: pre-line;width: fit-content;">
                            {{{input:item.reply.text,breakpoint:30}|linebreak}}
                        </div>
                        <div *ngIf="item.reply.image" style="position: relative;top: 20px;
                            border-bottom-left-radius: 15px;
                            border-top-left-radius: 15px;
                            border-top-right-radius:15px ;white-space: pre-line;width: fit-content;">
                            <img style="max-width: 100px;border-radius: 15px;opacity: 0.8;
                            filter: alpha(opacity=40);" src={{item.reply.image}} alt="img" (click)="openImageDialog(item.reply.image)">
                        </div>
                    </div>
                    <div>
                        <ng-template #elseSending>
                            <div style="z-index: 1;">

                                <app-side-chat [item]='item' (replyEvent)="replyClick($event)"></app-side-chat>
                            </div>
                        </ng-template>
                        <div class="sending" *ngIf="item.status==false;else elseSending" style="visibility: initial;">
                            sending
                        </div>
                        <div style="z-index: 1;">
                            <div *ngIf="isMoblie&&item.text" class="message" style="white-space: pre-line">
                                {{{input:item.text,breakpoint:20}|linebreak}}
                            </div>
                            <div *ngIf="!isMoblie&&item.text" class="message" style="white-space: pre-line">
                                {{{input:item.text,breakpoint:30}|linebreak}}
                            </div>
                            <div *ngIf="isMoblie&&item.image">
                                <img style="max-width: 200px;border-radius: 15px;" src={{item.image}} alt="img"  (click)="openImageDialog(item.image)">
                            </div>
                            <div *ngIf="!isMoblie&&item.image">
                                <img style="max-width: 300px;border-radius: 15px;" src={{item.image}} alt="img"  (click)="openImageDialog(item.image)">
                            </div>
                        </div>
                    </div>

                </div>
                <div *ngIf="authSer.uid!==item.user?.uid" class="messages messages--received">
                    <!-- reply -->
                    <div *ngIf="isMoblie&&item.reply">
                        <div>
                            <div *ngIf="item.reply.text"
                                style="position: relative;top: 10px;padding: 7px 13px;background-color: rgb(240, 240, 240);
                            border-bottom-right-radius: 15px;
                            border-top-left-radius: 15px;
                            border-top-right-radius:15px ;visibility: visible;white-space: pre-line;width: fit-content;">
                                {{{input:item.reply.text,breakpoint:20}|linebreak}}
                            </div>
                            <div  *ngIf="!item.reply.text"style="position: relative;top: 20px;
                                border-bottom-left-radius: 15px;
                                border-top-left-radius: 15px;
                                border-top-right-radius:15px ;white-space: pre-line;width: fit-content;">
                                <img  style="max-width: 100px;border-radius: 15px;opacity: 0.8;
                                filter: alpha(opacity=40);" src={{item.reply.image}} alt="img" (click)="openImageDialog(item.reply.image)">
                                
                            </div>
                        </div>
                    </div>
                    <div *ngIf="!isMoblie&&item.reply">
                        <div>
                            <div *ngIf="item.reply.text"
                                style="position: relative;top: 10px;padding: 7px 13px;background-color: rgb(240, 240, 240);
                            border-bottom-right-radius: 15px;
                            border-top-left-radius: 15px;
                            border-top-right-radius:15px ;visibility: visible;white-space: pre-line;width: fit-content;">
                                {{{input:item.reply.text,breakpoint:30}|linebreak}}
                            </div>
                            <div *ngIf="!item.reply.text"  style="position: relative;top: 20px;
                                border-bottom-left-radius: 15px;
                                border-top-left-radius: 15px;
                                border-top-right-radius:15px ;white-space: pre-line;width: fit-content;">
                                <img style="max-width: 100px;border-radius: 15px;opacity: 0.8;
                                filter: alpha(opacity=40);" src={{item.reply.image}} alt="img" (click)="openImageDialog(item.reply.image)">
                                
                            </div>
                        </div>
                    </div>
                    <div style="z-index: 1;">
                        <span *ngIf="isMoblie&&item.text" class="message" style="white-space: pre-line">
                            {{{input:item.text,breakpoint:20}|linebreak}}
                        </span>
                        <span *ngIf="!isMoblie&&item.text" class="message" style="white-space: pre-line">
                            {{{input:item.text,breakpoint:30}|linebreak}}
                        </span>
                        <span *ngIf="isMoblie&&item.image">
                            <img style="max-width: 200px;border-radius: 15px;" src={{item.image}} alt="img" (click)="openImageDialog(item.image)">

                        </span>
                        <span *ngIf="!isMoblie&&item.image">
                            <img style="max-width: 300px;border-radius: 15px;" src={{item.image}} alt="img"  (click)="openImageDialog(item.image)">

                        </span>

                        <div style="z-index: 1;">
                            <app-side-chat [item]='item' (replyEvent)="replyClick($event)"></app-side-chat>
                        </div>
                    </div>
                </div>

            </div>


        </div>
        <div class="text-bar" style="height:  5%">
            <div *ngIf="(reply | json) != '{}'">
                <div *ngIf="!isMoblie&&reply.text" style="position: fixed;padding: 0px 5px;
                bottom: 6%;background-color: white;" [ngStyle]="{'width':(shareSer.menu)?'80%':'100%'}">
                    <div style="display: flex;justify-content: space-between;">
                        <div>
                            {{reply.text}}
                        </div>
                        <button class="button" (click)="reply = {}">
                            x
                        </button>
                    </div>
                </div>
                <div *ngIf="isMoblie&&reply.text" style="position: fixed;
            bottom: 6%;width: 100%;background-color: white;padding: 0px 5px;">
                    <div style="display: flex;justify-content: space-between;">
                        <div>
                            {{reply.text}}
                        </div>
                        <button class="button" (click)="reply = {}">
                            x
                        </button>
                    </div>
                </div>
                <div *ngIf="!isMoblie&&reply.image" style="z-index: 5;position: fixed;padding: 0px 5px;
                bottom: 6%;background-color: white;" [ngStyle]="{'width':(shareSer.menu)?'80%':'100%'}">
                    <div style="display: flex;justify-content: space-between;align-items: center;padding: 0 1rem;">
                        <div>
                            <img style="max-width: 100px;border-radius: 15px;" src={{reply.image}} alt="img">

                        </div>
                        <button class="button" style="height: 50%;" (click)="reply = {}">
                            x
                        </button>
                    </div>
                </div>
                <div *ngIf="isMoblie&&reply.image" style="position: fixed;
            bottom: 6%;width: 100%;background-color: white;padding: 0px 5px;">
                    <div style="display: flex;justify-content: space-between;align-items: center;padding: 0 1rem;">
                        <div>
                            <img style="max-width: 100px;border-radius: 15px;" src={{reply.image}} alt="img">

                        </div>
                        <button class="button" style="height: 50%;" (click)="reply = {}">
                            x
                        </button>
                    </div>
                </div>
            </div>

            <div style="display: flex;height:100%">

                <div class="text-bar__field">
                    <textarea type="text" [(ngModel)]="text" placeholder="Type your text here..."
                        (keyup.enter)="sendMessage()" style="width: 100%;text-align: center;"></textarea>

                </div>
                <div style="width:fit-content;width:50px;">
                    <div style="border: 0.1px solid black;height: 100%;">
                        <button style="width: 100%;height: 100%;">
                            emo
                        </button>
                    </div>
                </div>
                <div style="width:fit-content;width:50px;">
                    <div style="border: 0.1px solid black;height: 100%;">
                        <button style="width: 100%;height: 100%;" (click)="uploadMultipleFiles()">
                            img
                        </button>
                    </div>
                </div>
                <div style="width:fit-content;width:50px;">
                    <div style="border: 0.1px solid black;height: 100%;">
                        <button style="width: 100%;height: 100%;" (click)="sendMessage()">
                            send
                        </button>
                    </div>
                </div>
                <!-- <div class="text-bar__thumb">
                    <div class="thumb" (click)="sendMessage()"></div>

                </div> -->
            </div>
        </div>
    </div>
</div>



<!-- <div *ngIf="room==null" style="border: 1px solid black;width: 100%;height: 100%">
    selected none
</div> -->

<!-- <div *ngIf="loading &&room!=null" id="chatBar" style="border: solid blue;width: 100%;height: 100%;">
    <div>
        <button (click)="add()"></button>
    </div>
    <div id="chatList">

        <div *ngFor="let item of messages" style="margin-top:1%;" class="chat mine">

            <span style="padding: 3%;">
                {{item.message}}
            </span>
        </div>

         <div class="chat theirs">hello moon</div> 
    </div>
    <div style="display: flex;">
        <div style="width: 60%">
            <input [(ngModel)]="text" (keyup.enter)="sendMessage()" style="width: 100%;">
        </div>
        <div style="width: 40%;">
            <button>Img</button>
            <button (click)="sendMessage()">Send</button>
        </div>
    </div>
</div> -->
<!-- <div *ngIf="loading &&room!=null" style="display: flex;    flex-direction: column;
;border: solid blue;width: 100%;height: 100%;overflow: hidden;">
    <div style="height: 5%;">
        <button (click)="add()"></button>
    </div>
    <div style="height: 85%;">
        
        
        <div style="flex: 1 1 20%;
        display: flex;
        flex-direction: column;
        overflow: auto;">
            <span *ngFor="let item of messages">
                <p style="  align-self: flex-end;
                background-color: lightgreen;">
                    {{item.message}}
                </p>
            </span>
        </div>
    </div>

    <div style="height: 10%;border: solid red; display: flex;">
        <div style="width: 60%">
            <input [(ngModel)]="text" (keyup.enter)="sendMessage()" style="width: 100%;">
        </div>
        <div style="width: 40%;">
            <button>Img</button>
            <button (click)="sendMessage()">Send</button>
        </div>
    </div>
</div> -->